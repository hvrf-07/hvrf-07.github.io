<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab Maya Biologi - SMAN 1 Cipatat</title>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Load React & ReactDOM (CDNJS - Lebih Stabil) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Load Babel for JSX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    
    <style>
        /* Custom Animation for Background */
        @keyframes blob {
          0% { transform: translate(0px, 0px) scale(1); }
          33% { transform: translate(30px, -50px) scale(1.1); }
          66% { transform: translate(-20px, 20px) scale(0.9); }
          100% { transform: translate(0px, 0px) scale(1); }
        }
        @keyframes bubble {
            0% { transform: translateY(0) scale(1); opacity: 0.8; }
            100% { transform: translateY(-150px) scale(1.5); opacity: 0; }
        }
        .animate-blob {
          animation: blob 7s infinite;
        }
        .animation-delay-2000 {
          animation-delay: 2s;
        }
        .animation-delay-4000 {
          animation-delay: 4s;
        }
        .cursor-wait {
            cursor: wait;
        }
        /* Loading Screen */
        #loading {
            position: fixed; inset: 0; background: #f8fafc; z-index: 50;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-family: sans-serif; color: #475569;
        }
        /* Error Box */
        #error-box {
            display: none; position: fixed; top: 0; left: 0; width: 100%; 
            background: #ef4444; color: white; padding: 1rem; text-align: center; z-index: 100;
            font-family: sans-serif;
        }
    </style>
</head>
<body class="bg-slate-50">
    
    <!-- Error Handler -->
    <div id="error-box"></div>
    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            const errorBox = document.getElementById('error-box');
            errorBox.style.display = 'block';
            errorBox.innerHTML = `<strong>Error:</strong> ${message} <br><small>Line: ${lineno}</small>`;
            // Sembunyikan loading jika error
            const loading = document.getElementById('loading');
            if(loading) loading.style.display = 'none';
        };
    </script>

    <!-- Loading Indicator -->
    <div id="loading">
        <div style="width: 40px; height: 40px; border: 4px solid #e2e8f0; border-top-color: #10b981; border-radius: 50%; animation: spin 1s linear infinite;"></div>
        <p style="margin-top: 1rem; font-weight: bold;">Memuat Laboratorium Maya...</p>
        <p style="font-size: 0.8rem; opacity: 0.7;">Pastikan koneksi internet lancar</p>
        <style>@keyframes spin { to { transform: rotate(360deg); } }</style>
    </div>

    <div id="root"></div>

    <script type="text/babel">
        // Mengambil components dari Global Scope
        const { useState, useEffect } = React;

        // --- DEFINISI IKON MANUAL (Diperbarui dengan prop size) ---
        const Icon = ({ children, className, size = 24, ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className} 
                {...props}
            >
                {children}
            </svg>
        );

        const Beaker = (props) => <Icon {...props}><path d="M4.5 3h15"/><path d="M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3"/><path d="M6 14h12"/></Icon>;
        const Pipette = (props) => <Icon {...props}><path d="M2 22 12 12"/><path d="M9 15 15 9"/><path d="M12 2v4"/><path d="M2 12h4"/><path d="m19 5 3-3"/></Icon>;
        const Flame = (props) => <Icon {...props}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.5-3.3.3-1.1.8-2.1 1.5-3.2"/></Icon>;
        const Info = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></Icon>;
        const RotateCcw = (props) => <Icon {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></Icon>;
        const Droplets = (props) => <Icon {...props}><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.35"/></Icon>;
        const BookOpen = (props) => <Icon {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></Icon>;
        const CheckCircle = (props) => <Icon {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="M22 4 12 14.01l-3-3"/></Icon>;
        const XCircle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></Icon>;
        const User = (props) => <Icon {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></Icon>;
        const Save = (props) => <Icon {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></Icon>;
        const ClipboardList = (props) => <Icon {...props}><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></Icon>;
        const School = (props) => <Icon {...props}><path d="M14 22v-4a2 2 0 1 0-4 0v4"/><path d="m18 10 4 2v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-8l4-2"/><path d="M18 5v17"/><path d="m4 6 8-4 8 4"/><path d="M6 5v17"/><circle cx="12" cy="9" r="2"/></Icon>;
        const Leaf = (props) => <Icon {...props}><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></Icon>;
        const Dna = (props) => <Icon {...props}><path d="M2 15c6.667-6 13.333 0 20-6"/><path d="M9 22c1.798-1.998 2.518-3.995 2.807-5.993"/><path d="M15 2c-1.798 1.998-2.518 3.995-2.807 5.993"/><path d="M17 12a5.73 5.73 0 0 0 4 0"/><path d="M3 12a5.73 5.73 0 0 0 4 0"/></Icon>;
        const Activity = (props) => <Icon {...props}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></Icon>;
        const ArrowRight = (props) => <Icon {...props}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></Icon>;
        const RefreshCw = (props) => <Icon {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></Icon>;
        const ChevronDown = (props) => <Icon {...props}><path d="m6 9 6 6 6-6"/></Icon>;
        const Send = (props) => <Icon {...props}><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></Icon>;
        const Link = (props) => <Icon {...props}><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></Icon>;

        // --- DATA REFERENSI ---
        const REAGENTS = [
            {
                id: 'lugol',
                name: 'Lugol (Iodine)',
                target: 'Amilum',
                baseColor: 'bg-amber-600',
                positiveColor: 'bg-slate-900',
                negativeColor: 'bg-amber-600',
                desc: 'Indikator Amilum (Karbohidrat).',
                requiresHeat: false,
            },
            {
                id: 'biuret',
                name: 'Biuret',
                target: 'Protein',
                baseColor: 'bg-blue-400',
                positiveColor: 'bg-purple-600',
                negativeColor: 'bg-blue-400',
                desc: 'Indikator Protein (Ikatan Peptida).',
                requiresHeat: false,
            },
            {
                id: 'benedict',
                name: 'Benedict',
                target: 'Glukosa',
                baseColor: 'bg-cyan-500',
                positiveColor: 'bg-red-600',
                negativeColor: 'bg-cyan-500',
                desc: 'Indikator Glukosa (Gula Pereduksi). Butuh pemanasan.',
                requiresHeat: true,
            },
            {
                id: 'ethanol',
                name: 'Etanol / Kertas Buram',
                target: 'Lemak',
                baseColor: 'bg-white/20 border-2 border-dashed border-slate-300',
                positiveColor: 'bg-yellow-100/40 backdrop-blur-sm',
                negativeColor: 'bg-white',
                desc: 'Indikator Lemak (Transparansi/Emulsi).',
                requiresHeat: false,
                isPaperTest: true
            }
        ];

        const FOODS = [
            { 
                id: 'nasi', 
                name: 'Larutan Nasi', 
                icon: 'ðŸš', 
                contents: { amilum: true, protein: false, glukosa: true, lemak: false },
                baseColor: 'bg-slate-100'
            },
            { 
                id: 'telur', 
                name: 'Putih Telur', 
                icon: 'ðŸ¥š', 
                contents: { amilum: false, protein: true, glukosa: false, lemak: false },
                baseColor: 'bg-yellow-50'
            },
            { 
                id: 'susu', 
                name: 'Susu', 
                icon: 'ðŸ¥›', 
                contents: { amilum: false, protein: true, glukosa: true, lemak: true },
                baseColor: 'bg-white'
            },
            { 
                id: 'minyak', 
                name: 'Minyak Goreng', 
                icon: 'ðŸŒ»', 
                contents: { amilum: false, protein: false, glukosa: false, lemak: true },
                baseColor: 'bg-yellow-200'
            },
            { 
                id: 'tahu', 
                name: 'Ekstrak Tahu', 
                icon: 'ðŸ§Š', 
                contents: { amilum: false, protein: true, glukosa: false, lemak: false },
                baseColor: 'bg-stone-100'
            },
            { 
                id: 'jeruk', 
                name: 'Air Jeruk', 
                icon: 'ðŸŠ', 
                contents: { amilum: false, protein: false, glukosa: true, lemak: false },
                baseColor: 'bg-orange-100'
            }
        ];

        const CONCLUSION_OPTIONS = [
            { id: 'Amilum', label: 'Mengandung Amilum' },
            { id: 'Protein', label: 'Mengandung Protein' },
            { id: 'Glukosa', label: 'Mengandung Glukosa' },
            { id: 'Lemak', label: 'Mengandung Lemak' },
            { id: 'Netral', label: 'Netral / Tidak Mengandung Zat Diuji' }
        ];

        const MOVING_CLASSES = ['Biologi 1', 'Biologi 2', 'Biologi 3', 'Biologi 4', 'Biologi 5'];
        const ORIGIN_CLASSES = ['XII A', 'XII B', 'XII C', 'XII D', 'XII E', 'XII F', 'XII G', 'XII H', 'XII I'];

        const GOOGLE_SCRIPT_URL_DEFAULT = "https://script.google.com/macros/s/AKfycbxifiH3Vjr87A21Gp4ktWxqywQrKCUxH85AVX17YqIfEB6pJm9Bva8eRElZu89sa3QZ/exec"; 

        function VirtualFoodLab() {
            // User State
            const [userData, setUserData] = useState({ name: '', movingClass: '', originClass: '', isLoggedIn: false });
            const [tempName, setTempName] = useState('');
            const [tempMovingClass, setTempMovingClass] = useState('');
            const [tempOriginClass, setTempOriginClass] = useState('');
            
            // Configuration State
            const [scriptUrl, setScriptUrl] = useState(GOOGLE_SCRIPT_URL_DEFAULT);
            const [showConfig, setShowConfig] = useState(false);

            // Lab State
            const [selectedFood, setSelectedFood] = useState(null);
            const [selectedReagent, setSelectedReagent] = useState(null);
            const [isReacting, setIsReacting] = useState(false);
            
            // Logic State
            const [visualResult, setVisualResult] = useState(null); 
            const [heatApplied, setHeatApplied] = useState(false);
            const [showConclusionModal, setShowConclusionModal] = useState(false);
            const [finalLog, setFinalLog] = useState([]); 
            const [showTheory, setShowTheory] = useState(false);
            const [completedFoods, setCompletedFoods] = useState([]); 
            const [isSending, setIsSending] = useState(false);

            // --- HANDLERS ---
            const handleLogin = (e) => {
                e.preventDefault();
                if (tempName && tempMovingClass && tempOriginClass) {
                    setUserData({ 
                        name: tempName, 
                        movingClass: tempMovingClass,
                        originClass: tempOriginClass,
                        isLoggedIn: true 
                    });
                }
            };

            const resetLab = () => {
                setSelectedFood(null);
                setSelectedReagent(null);
                setVisualResult(null);
                setHeatApplied(false);
                setShowConclusionModal(false);
            };

            const resetAll = () => {
                if(window.confirm("Apakah anda yakin ingin menghapus semua data hasil praktikum dan mulai dari awal?")) {
                    setFinalLog([]);
                    setCompletedFoods([]);
                    resetLab();
                }
            };

            const handleTest = () => {
                if (!selectedFood || !selectedReagent) return;
                setIsReacting(true);
                setTimeout(() => {
                    calculateVisualResult(false);
                    setIsReacting(false);
                }, 1500);
            };

            const handleHeat = () => {
                setHeatApplied(true);
                setIsReacting(true);
                setTimeout(() => {
                    calculateVisualResult(true);
                    setIsReacting(false);
                }, 1500);
            };

            const calculateVisualResult = (isHeated) => {
                let colorClass = selectedReagent.negativeColor;
                let isPositive = false;
                let pendingHeat = false;

                if (selectedReagent.id === 'lugol' && selectedFood.contents.amilum) {
                    isPositive = true;
                } else if (selectedReagent.id === 'biuret' && selectedFood.contents.protein) {
                    isPositive = true;
                } else if (selectedReagent.id === 'benedict' && selectedFood.contents.glukosa) {
                    if (isHeated) {
                        isPositive = true;
                    } else {
                        pendingHeat = true;
                    }
                } else if (selectedReagent.id === 'ethanol' && selectedFood.contents.lemak) {
                    isPositive = true;
                }

                if (isPositive) {
                    colorClass = selectedReagent.positiveColor;
                }

                setVisualResult({
                    isPositive,
                    colorClass,
                    pendingHeat
                });

                if (!pendingHeat) {
                    setTimeout(() => setShowConclusionModal(true), 500);
                }
            };

            const handleConclusionSubmit = (conclusionId) => {
                let isCorrectConclusion = false;
                if (visualResult.isPositive) {
                    if (conclusionId === selectedReagent.target) isCorrectConclusion = true;
                } else {
                    if (conclusionId === 'Netral') isCorrectConclusion = true;
                }

                const newLog = {
                    timestamp: new Date().toLocaleTimeString(),
                    food: selectedFood.name,
                    reagent: selectedReagent.name,
                    visualResult: visualResult.isPositive ? 'Berubah Warna (+)' : 'Tidak Berubah (-)',
                    userConclusion: conclusionId,
                    isCorrect: isCorrectConclusion
                };

                const updatedLog = [newLog, ...finalLog];
                setFinalLog(updatedLog);
                
                if (!completedFoods.includes(selectedFood.id)) {
                    setCompletedFoods([...completedFoods, selectedFood.id]);
                }

                setShowConclusionModal(false);
            };

            const handleFinishAndSend = async () => {
                if (!scriptUrl) {
                    alert("Mohon masukkan URL Google Apps Script terlebih dahulu.");
                    return;
                }

                setIsSending(true);

                const dataSpreadsheet = finalLog.map(log => ({
                    Waktu: new Date().toLocaleString(),
                    Nama: userData.name,
                    Kelas_Biologi: userData.movingClass,
                    Kelas_Asal: userData.originClass,
                    Nama_Bahan: log.food,
                    Nama_Reagen: log.reagent,
                    Kesimpulan_Siswa: log.userConclusion,
                    Hasil_Analisis: log.isCorrect ? 'TEPAT' : 'TIDAK TEPAT'
                }));

                console.log("Payload:", JSON.stringify(dataSpreadsheet));

                try {
                    await fetch(scriptUrl, {
                        method: 'POST',
                        body: JSON.stringify(dataSpreadsheet),
                        mode: "no-cors",
                        headers: {
                            "Content-Type": "text/plain"
                        }
                    });

                    alert(`SUKSES!\n\nLaporan praktikum milik ${userData.name} telah berhasil dikirim ke Spreadsheet Guru.\n\nTerima kasih!`);
                } catch (error) {
                    console.error("Error sending data:", error);
                    alert("Gagal mengirim data. Pastikan koneksi internet lancar dan URL Script benar.");
                } finally {
                    setIsSending(false);
                }
            };

            const getColorName = (className) => {
                if (className.includes('slate-900')) return 'Biru Kehitaman';
                if (className.includes('purple')) return 'Ungu';
                if (className.includes('red')) return 'Merah Bata';
                if (className.includes('yellow-100')) return 'Transparan';
                return 'Warna Asal';
            };

            const BackgroundDecoration = () => (
                <div className="fixed inset-0 pointer-events-none overflow-hidden z-0 opacity-10">
                    <Dna className="absolute top-10 left-10 text-emerald-800 w-32 h-32 rotate-12" />
                    <Leaf className="absolute bottom-20 right-10 text-teal-800 w-40 h-40 -rotate-12" />
                    <Activity className="absolute top-1/3 right-20 text-indigo-800 w-24 h-24" />
                    <div className="absolute top-1/2 left-1/4 w-64 h-64 bg-yellow-300 rounded-full blur-3xl mix-blend-multiply filter opacity-30 animate-blob"></div>
                    <div className="absolute top-1/3 right-1/4 w-64 h-64 bg-purple-300 rounded-full blur-3xl mix-blend-multiply filter opacity-30 animate-blob animation-delay-2000"></div>
                    <div className="absolute bottom-1/4 left-1/3 w-64 h-64 bg-pink-300 rounded-full blur-3xl mix-blend-multiply filter opacity-30 animate-blob animation-delay-4000"></div>
                </div>
            );

            // --- RENDER LOGIN SCREEN ---
            if (!userData.isLoggedIn) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-emerald-100 via-teal-50 to-indigo-100 flex items-center justify-center p-4 font-sans relative overflow-hidden">
                        <BackgroundDecoration />
                        
                        <div className="absolute top-4 right-4 z-20">
                            <button 
                                onClick={() => setShowConfig(!showConfig)}
                                className="bg-white/50 p-2 rounded-full hover:bg-white text-emerald-700 transition-colors"
                                title="Konfigurasi Spreadsheet"
                            >
                                <Link size={20} />
                            </button>
                        </div>

                        {showConfig && (
                            <div className="absolute inset-0 z-30 bg-black/50 flex items-center justify-center p-4">
                                <div className="bg-white p-6 rounded-xl shadow-2xl max-w-lg w-full">
                                    <h3 className="font-bold text-lg mb-2">Konfigurasi Database</h3>
                                    <p className="text-sm text-slate-500 mb-4">Masukkan URL Web App dari Google Apps Script Deployment anda di sini.</p>
                                    <input 
                                        type="text" 
                                        value={scriptUrl} 
                                        onChange={(e) => setScriptUrl(e.target.value)}
                                        placeholder="https://script.google.com/macros/s/..../exec"
                                        className="w-full p-2 border border-slate-300 rounded mb-4 text-xs font-mono"
                                    />
                                    <div className="flex justify-end gap-2">
                                        <button onClick={() => setShowConfig(false)} className="px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700">Simpan</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        <div className="bg-white/90 backdrop-blur-md p-8 rounded-3xl shadow-2xl max-w-md w-full border border-white/50 relative z-10">
                            <div className="flex justify-center mb-6">
                                <div className="relative w-28 h-28 bg-white rounded-full p-2 shadow-lg flex items-center justify-center overflow-hidden">
                                    <img 
                                        src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEghKCKGZKfCCKHksaxEq2kC3IlYCt6YNWjOU305T5faT0FpUuQpReGEkJ3wWogNwa9mSEVe7Aav7hSz0Ea9SdNu_PIl2cmvgNQqG9xp9Fmvgegg_wNuO84HE19CX0qmAH3MMahmUtq7Sxw/s320/Logo+SMAN+1+Cipatat+baru.jpg" 
                                        alt="Logo Sekolah" 
                                        className="w-full h-full object-contain"
                                        onError={(e) => {
                                            e.target.style.display = 'none';
                                            e.target.parentElement.innerHTML = '<span class="text-3xl">ðŸ§¬</span>';
                                        }}
                                    />
                                </div>
                            </div>
                            <h1 className="text-3xl font-extrabold text-center text-emerald-900 mb-2 drop-shadow-sm">Lab Biologi Maya</h1>
                            <p className="text-center text-emerald-600 mb-8 font-medium">Ujian Praktek Biologi<br/>SMA Negeri 1 Cipatat</p>
                            
                            <form onSubmit={handleLogin} className="space-y-5">
                                <div>
                                    <label className="block text-sm font-bold text-emerald-800 mb-2">Nama Siswa</label>
                                    <input 
                                        type="text" 
                                        required
                                        className="w-full p-3 border-2 border-emerald-100 rounded-xl focus:border-emerald-500 focus:ring-4 focus:ring-emerald-200 outline-none transition-all bg-white/80"
                                        placeholder="Masukkan nama lengkap..."
                                        value={tempName}
                                        onChange={(e) => setTempName(e.target.value)}
                                    />
                                </div>
                                
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-bold text-emerald-800 mb-2">Kelas Biologi</label>
                                        <div className="relative">
                                            <select 
                                                required
                                                className="w-full p-3 border-2 border-emerald-100 rounded-xl focus:border-emerald-500 focus:ring-4 focus:ring-emerald-200 outline-none transition-all bg-white/80 appearance-none cursor-pointer"
                                                value={tempMovingClass}
                                                onChange={(e) => setTempMovingClass(e.target.value)}
                                            >
                                                <option value="" disabled>Pilih...</option>
                                                {MOVING_CLASSES.map(cls => (
                                                    <option key={cls} value={cls}>{cls}</option>
                                                ))}
                                            </select>
                                            <ChevronDown className="absolute right-3 top-3.5 text-emerald-600 pointer-events-none" size={16} />
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-bold text-emerald-800 mb-2">Kelas Asal</label>
                                        <div className="relative">
                                            <select 
                                                required
                                                className="w-full p-3 border-2 border-emerald-100 rounded-xl focus:border-emerald-500 focus:ring-4 focus:ring-emerald-200 outline-none transition-all bg-white/80 appearance-none cursor-pointer"
                                                value={tempOriginClass}
                                                onChange={(e) => setTempOriginClass(e.target.value)}
                                            >
                                                <option value="" disabled>Pilih...</option>
                                                {ORIGIN_CLASSES.map(cls => (
                                                    <option key={cls} value={cls}>{cls}</option>
                                                ))}
                                            </select>
                                            <ChevronDown className="absolute right-3 top-3.5 text-emerald-600 pointer-events-none" size={16} />
                                        </div>
                                    </div>
                                </div>

                                <button 
                                    type="submit"
                                    className="w-full bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg transform hover:scale-[1.02] mt-6 flex justify-center items-center gap-2"
                                >
                                    <User size={20} />
                                    Masuk Laboratorium
                                </button>
                            </form>
                            <div className="mt-8 text-center text-xs text-emerald-600/60 font-medium">
                                Dikembangkan oleh Rubs
                            </div>
                        </div>
                    </div>
                );
            }

            // --- RENDER MAIN LAB ---
            return (
                <div className="min-h-screen bg-gradient-to-br from-emerald-50 via-cyan-50 to-indigo-50 font-sans text-slate-800 p-4 md:p-8 relative">
                    <BackgroundDecoration />
                    
                    {/* Header */}
                    <header className="relative z-20 max-w-6xl mx-auto mb-6 flex flex-col md:flex-row justify-between items-center bg-white/80 backdrop-blur-md p-4 rounded-2xl shadow-lg border border-white/50 gap-4">
                        <div className="flex items-center gap-4 w-full md:w-auto">
                            <div className="w-16 h-16 shrink-0 flex items-center justify-center bg-white rounded-xl shadow-md overflow-hidden border border-emerald-100">
                                <img 
                                    src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEghKCKGZKfCCKHksaxEq2kC3IlYCt6YNWjOU305T5faT0FpUuQpReGEkJ3wWogNwa9mSEVe7Aav7hSz0Ea9SdNu_PIl2cmvgNQqG9xp9Fmvgegg_wNuO84HE19CX0qmAH3MMahmUtq7Sxw/s320/Logo+SMAN+1+Cipatat+baru.jpg" 
                                    alt="Logo" 
                                    className="w-full h-full object-contain"
                                    onError={(e) => {
                                        e.target.style.display = 'none';
                                        e.target.parentElement.innerHTML = '<span class="text-2xl">ðŸ§¬</span>';
                                    }}
                                />
                            </div>
                            <div>
                                <h1 className="text-xl font-extrabold text-emerald-900 leading-tight tracking-tight">UJIAN PRAKTEK BIOLOGI</h1>
                                <h2 className="text-lg text-teal-600 font-bold">SMA NEGERI 1 CIPATAT</h2>
                                <div className="flex items-center gap-2 text-xs font-semibold text-slate-600 mt-1">
                                    <span className="bg-emerald-100 text-emerald-800 px-3 py-0.5 rounded-full border border-emerald-200 flex items-center gap-1"><User size={10}/> {userData.name}</span>
                                    <span className="bg-indigo-100 text-indigo-800 px-3 py-0.5 rounded-full border border-indigo-200"><School size={10} className="inline mr-1"/> {userData.originClass}</span>
                                    <span className="bg-teal-100 text-teal-800 px-3 py-0.5 rounded-full border border-teal-200"><Activity size={10} className="inline mr-1"/> {userData.movingClass}</span>
                                </div>
                            </div>
                        </div>
                        <div className="flex items-center gap-2">
                            <button 
                                onClick={() => setShowTheory(!showTheory)}
                                className="flex items-center justify-center gap-2 px-4 py-2 bg-indigo-100 text-indigo-700 rounded-xl hover:bg-indigo-200 transition-colors text-sm font-bold shadow-sm"
                            >
                                <BookOpen size={18} />
                                Materi
                            </button>
                        </div>
                    </header>

                    {/* Main Grid */}
                    <main className="relative z-10 max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-6 pb-20">
                        
                        {/* Left Column: Selection */}
                        <div className="lg:col-span-4 space-y-6">
                            <div className="bg-white/80 backdrop-blur-md p-5 rounded-2xl shadow-lg border border-white/60">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xs font-black uppercase tracking-widest text-emerald-600 flex items-center gap-2">
                                    <span className="bg-emerald-200 text-emerald-800 w-6 h-6 flex items-center justify-center rounded-full shadow-sm">1</span> Pilih Sampel
                                    </h2>
                                    <div className="text-xs font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-full border border-emerald-100">
                                        Progress: {completedFoods.length} / {FOODS.length}
                                    </div>
                                </div>
                                <div className="grid grid-cols-2 gap-3">
                                    {FOODS.map((food) => {
                                        const isCompleted = completedFoods.includes(food.id);
                                        const isSelected = selectedFood?.id === food.id;
                                        return (
                                            <button
                                                key={food.id}
                                                disabled={visualResult && !completedFoods.includes(food.id)} 
                                                onClick={() => { setSelectedFood(food); setVisualResult(null); setHeatApplied(false); }}
                                                className={`relative p-3 rounded-xl border-2 text-left transition-all transform hover:scale-[1.02] active:scale-95 shadow-sm
                                                    ${isSelected 
                                                    ? 'border-emerald-500 bg-emerald-50 ring-2 ring-emerald-200' 
                                                    : isCompleted 
                                                        ? 'border-slate-200 bg-slate-50 opacity-70 grayscale'
                                                        : 'border-white bg-white hover:border-emerald-300'
                                                    }
                                                `}
                                            >
                                                {isCompleted && <div className="absolute top-2 right-2 text-green-600 bg-green-100 rounded-full p-0.5"><CheckCircle size={14}/></div>}
                                                <span className="text-3xl block mb-2">{food.icon}</span>
                                                <span className="font-bold text-sm text-slate-700">{food.name}</span>
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>

                            <div className="bg-white/80 backdrop-blur-md p-5 rounded-2xl shadow-lg border border-white/60">
                                <h2 className="text-xs font-black uppercase tracking-widest text-purple-600 mb-4 flex items-center gap-2">
                                    <span className="bg-purple-200 text-purple-800 w-6 h-6 flex items-center justify-center rounded-full shadow-sm">2</span> Pilih Reagen
                                </h2>
                                <div className="space-y-2">
                                    {REAGENTS.map((reagent) => (
                                        <button
                                            key={reagent.id}
                                            disabled={visualResult && !completedFoods.includes(selectedFood?.id)}
                                            onClick={() => { setSelectedReagent(reagent); setVisualResult(null); setHeatApplied(false); }}
                                            className={`w-full p-3 rounded-xl border-2 text-left flex items-center gap-3 transition-all transform hover:translate-x-1
                                                ${selectedReagent?.id === reagent.id 
                                                ? 'border-purple-500 bg-purple-50 ring-2 ring-purple-200' 
                                                : 'border-white bg-white hover:border-purple-300'
                                                }
                                            `}
                                        >
                                            <div className={`w-10 h-10 rounded-full ${reagent.baseColor} border-2 border-white shadow-md flex items-center justify-center text-xs text-white/70 font-bold`}>
                                                {reagent.id === 'ethanol' && 'Eth'}
                                            </div>
                                            <div>
                                                <div className="font-bold text-sm text-slate-800">{reagent.name}</div>
                                            </div>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Center Column: The Lab Bench */}
                        <div className="lg:col-span-8 space-y-6">
                            
                            <div className="bg-white/90 backdrop-blur-xl rounded-3xl shadow-xl border border-white/50 overflow-hidden min-h-[550px] flex flex-col relative ring-1 ring-slate-900/5">
                                
                                {/* Theory Overlay */}
                                {showTheory && (
                                    <div className="absolute inset-0 bg-white/95 z-40 p-8 overflow-y-auto backdrop-blur-md animate-in fade-in slide-in-from-bottom-10">
                                        <div className="flex justify-between items-center mb-6">
                                            <h3 className="text-xl font-bold text-indigo-900 flex items-center gap-2"><BookOpen size={24}/> Materi Praktikum</h3>
                                            <button onClick={() => setShowTheory(false)} className="text-slate-400 hover:text-red-500 hover:bg-red-50 p-2 rounded-full transition-colors">
                                                <XCircle />
                                            </button>
                                        </div>
                                        <div className="grid gap-4 md:grid-cols-2">
                                            <div className="p-4 bg-amber-50 rounded-xl border border-amber-100 shadow-sm">
                                                <h4 className="font-bold text-amber-800 text-sm mb-1">Lugol (Iodine)</h4>
                                                <p className="text-xs text-amber-700 leading-relaxed">Digunakan untuk uji Amilum. Warna asli cokelat/oranye. Jika positif mengandung amilum, berubah menjadi <b>Biru Kehitaman</b>.</p>
                                            </div>
                                            <div className="p-4 bg-purple-50 rounded-xl border border-purple-100 shadow-sm">
                                                <h4 className="font-bold text-purple-800 text-sm mb-1">Biuret</h4>
                                                <p className="text-xs text-purple-700 leading-relaxed">Digunakan untuk uji Protein. Warna asli biru muda. Jika positif mengandung protein (ikatan peptida), berubah menjadi <b>Ungu / Violet</b>.</p>
                                            </div>
                                            <div className="p-4 bg-red-50 rounded-xl border border-red-100 shadow-sm">
                                                <h4 className="font-bold text-red-800 text-sm mb-1">Benedict</h4>
                                                <p className="text-xs text-red-700 leading-relaxed">Digunakan untuk uji Glukosa. Warna asli biru jernih. Setelah ditetesi harus <b>DIPANASKAN</b>. Jika positif, berubah menjadi <b>Merah Bata</b>.</p>
                                            </div>
                                            <div className="p-4 bg-yellow-50 rounded-xl border border-yellow-100 shadow-sm">
                                                <h4 className="font-bold text-yellow-800 text-sm mb-1">Kertas Buram / Etanol</h4>
                                                <p className="text-xs text-yellow-700 leading-relaxed">Digunakan untuk uji Lemak. Jika dioleskan pada kertas buram, kertas menjadi <b>Transparan</b>.</p>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Modal Kesimpulan */}
                                {showConclusionModal && (
                                    <div className="absolute inset-0 z-50 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 animate-in zoom-in-95 duration-200">
                                        <div className="bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full border-t-8 border-emerald-500">
                                            <div className="flex justify-center -mt-12 mb-4">
                                                <div className="bg-emerald-500 text-white p-3 rounded-full shadow-lg">
                                                    <Activity size={32} />
                                                </div>
                                            </div>
                                            <h3 className="text-xl font-bold text-center text-slate-800 mb-2">Analisis Hasil</h3>
                                            <p className="text-sm text-center text-slate-500 mb-6">
                                                Berdasarkan perubahan warna yang terjadi, apa kandungan zat pada bahan ini?
                                            </p>
                                            
                                            <div className="p-4 bg-slate-50 rounded-xl border border-slate-100 mb-6 text-center">
                                                <span className="text-xs font-bold text-slate-400 uppercase tracking-wide block mb-1">Hasil Pengamatan</span>
                                                <span className={`text-lg font-bold ${visualResult?.isPositive ? 'text-emerald-600' : 'text-slate-600'}`}>
                                                    {visualResult?.isPositive 
                                                        ? `Berubah: ${getColorName(visualResult.colorClass)}` 
                                                        : 'Tidak Berubah Warna'}
                                                </span>
                                            </div>

                                            <div className="space-y-2">
                                                {CONCLUSION_OPTIONS.map((opt) => (
                                                    <button
                                                        key={opt.id}
                                                        onClick={() => handleConclusionSubmit(opt.id)}
                                                        className="w-full text-left px-4 py-3 rounded-lg border border-slate-200 hover:bg-emerald-50 hover:border-emerald-300 hover:text-emerald-700 transition-all font-semibold text-sm flex justify-between items-center group"
                                                    >
                                                        {opt.label}
                                                        <ArrowRight size={16} className="opacity-0 group-hover:opacity-100 transition-opacity transform group-hover:translate-x-1"/>
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Lab Visualization */}
                                <div className="flex-1 bg-gradient-to-b from-slate-50 to-slate-200 relative flex flex-col items-center justify-end pb-8 overflow-hidden">
                                    <div className="absolute top-0 left-0 w-full h-full opacity-5 pointer-events-none" style={{backgroundImage: 'radial-gradient(#4b5563 1px, transparent 1px)', backgroundSize: '20px 20px'}}></div>
                                    <div className="absolute bottom-0 w-full h-[140px] bg-slate-300 border-t-8 border-slate-400 shadow-inner"></div>

                                    <div className="absolute top-6 left-6 right-6 flex justify-between z-10">
                                        <div className={`px-4 py-1.5 rounded-full text-xs font-mono font-bold border shadow-sm transition-all ${heatApplied ? 'bg-red-100 text-red-600 border-red-200 animate-pulse' : 'bg-white/80 text-slate-500 border-slate-200'}`}>
                                            Suhu: {heatApplied ? '100Â°C (MENDIDIH)' : '25Â°C (RUANG)'}
                                        </div>
                                    </div>

                                    {/* Apparatus */}
                                    <div className="relative z-10 flex flex-col items-center mb-8">
                                        {isReacting && !heatApplied && (
                                            <div className="absolute -top-24 animate-bounce z-20">
                                                <Pipette className="text-slate-600 rotate-[-15deg] drop-shadow-xl" size={64} fill="rgba(0,0,0,0.1)" />
                                                <div className={`w-4 h-4 rounded-full mt-1 ml-2 animate-ping ${selectedReagent?.baseColor}`}></div>
                                            </div>
                                        )}

                                        {heatApplied && (
                                            <div className="absolute -bottom-10 z-20 flex flex-col items-center animate-in fade-in slide-in-from-bottom-8 duration-700">
                                                <div className="relative">
                                                    <Flame className="text-orange-500 animate-[pulse_0.5s_infinite]" size={80} fill="orange" />
                                                    <Flame className="text-yellow-300 absolute top-4 left-4 animate-[pulse_0.3s_infinite]" size={48} fill="yellow" />
                                                </div>
                                                <div className="w-24 h-6 bg-slate-800 rounded-full blur-md mt-[-15px] opacity-40"></div>
                                            </div>
                                        )}

                                        {/* Tabung Reaksi */}
                                        <div className="w-32 h-48 border-x-4 border-b-8 border-white/40 bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm rounded-b-[3rem] relative overflow-hidden shadow-2xl ring-1 ring-white/20 transform transition-all duration-700">
                                            <div className="absolute top-0 right-0 w-1/2 h-full bg-gradient-to-l from-white/20 to-transparent z-20 pointer-events-none"></div>
                                            <div className="absolute top-2 left-2 w-2 h-full bg-white/30 rounded-full blur-[1px] z-20 pointer-events-none"></div>

                                            <div 
                                                className={`absolute bottom-0 w-full transition-all duration-1000 ease-in-out z-10
                                                    ${selectedFood ? 'h-[70%]' : 'h-0'}
                                                    ${visualResult ? visualResult.colorClass : (selectedFood?.baseColor || 'bg-transparent')}
                                                `}
                                            >
                                                {(heatApplied || visualResult?.isPositive) && (
                                                    <div className="absolute inset-0 opacity-60">
                                                        {Array.from({length: 5}).map((_, i) => (
                                                            <div key={i} className="absolute bg-white rounded-full animate-bubble" 
                                                                style={{
                                                                    width: Math.random() * 10 + 5 + 'px',
                                                                    height: Math.random() * 10 + 5 + 'px',
                                                                    left: Math.random() * 100 + '%',
                                                                    bottom: '-10px',
                                                                    animationDuration: Math.random() * 2 + 1 + 's',
                                                                    animationDelay: Math.random() + 's'
                                                                }}>
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                        
                                        <div className="mt-6 bg-slate-800 text-white px-4 py-1.5 rounded-lg text-sm font-mono shadow-xl border border-slate-600">
                                            {selectedFood ? selectedFood.name : 'Wadah Kosong'}
                                        </div>
                                    </div>
                                </div>

                                {/* Action Bar */}
                                <div className="bg-white border-t border-slate-200 p-5 flex flex-col md:flex-row items-center justify-between gap-4">
                                    <div className="flex-1 text-sm">
                                        {!selectedFood ? (
                                            <div className="flex items-center gap-2 text-slate-500 animate-pulse">
                                                <ArrowRight size={18} /> Silakan pilih <b>Sampel Makanan</b> di kiri.
                                            </div>
                                        ) : !selectedReagent ? (
                                            <div className="flex items-center gap-2 text-slate-500">
                                                <ArrowRight size={18} /> Sekarang pilih <b>Reagen</b> penguji.
                                            </div>
                                        ) : visualResult?.pendingHeat ? (
                                            <div className="flex items-center gap-2 text-red-600 bg-red-50 p-2 rounded-lg border border-red-100 font-bold">
                                                <Flame size={18} className="animate-bounce" /> Reagen ini butuh pemanasan! Klik tombol Panaskan.
                                            </div>
                                        ) : finalLog.length > 0 && finalLog[0].food === selectedFood.name && finalLog[0].reagent === selectedReagent.name ? (
                                            <div className="flex items-center gap-3">
                                                <div className="flex items-center gap-1.5 text-emerald-700 bg-emerald-50 px-3 py-2 rounded-lg border border-emerald-100 font-bold">
                                                    <Save size={16} /> Data Tersimpan
                                                </div>
                                                <span className="text-slate-400 text-xs">Klik tombol "Lanjut" untuk sampel berikutnya.</span>
                                            </div>
                                        ) : (
                                            <div className="text-slate-600">
                                                Siap diuji. Klik tombol aksi di kanan.
                                            </div>
                                        )}
                                    </div>

                                    <div className="flex items-center gap-3 shrink-0">
                                        {(finalLog.length > 0 && finalLog[0].food === selectedFood?.name && finalLog[0].reagent === selectedReagent?.name) ? (
                                            <button 
                                                onClick={resetLab}
                                                className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white rounded-full font-bold shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all"
                                            >
                                                Simpan & Lanjut <ArrowRight size={18} />
                                            </button>
                                        ) : (
                                            <React.Fragment>
                                                {selectedReagent?.requiresHeat && (
                                                <button
                                                    onClick={handleHeat}
                                                    disabled={!visualResult?.pendingHeat || isReacting}
                                                    className={`flex items-center gap-2 px-6 py-3 rounded-full font-bold shadow-md transition-all
                                                    ${!visualResult?.pendingHeat 
                                                        ? 'bg-slate-100 text-slate-300 cursor-not-allowed' 
                                                        : 'bg-gradient-to-r from-orange-500 to-red-500 text-white hover:shadow-lg hover:scale-105 animate-pulse'
                                                    }`}
                                                >
                                                    <Flame size={18} fill="currentColor" />
                                                    Panaskan
                                                </button>
                                                )}

                                                <button
                                                    onClick={handleTest}
                                                    disabled={!selectedFood || !selectedReagent || isReacting || visualResult}
                                                    className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-full font-bold shadow-md hover:shadow-lg hover:-translate-y-0.5 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                                                >
                                                    <Droplets size={18} fill="currentColor" />
                                                    Teteskan Reagen
                                                </button>
                                            </React.Fragment>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Bottom Section: Result Log */}
                        <div className="lg:col-span-12 mt-4 animate-in fade-in slide-in-from-bottom-10 delay-100 pb-10">
                            <div className="bg-white/90 backdrop-blur-md rounded-2xl shadow-lg border border-white/50 overflow-hidden">
                                <div className="bg-gradient-to-r from-emerald-50 to-teal-50 px-6 py-4 border-b border-emerald-100 flex justify-between items-center">
                                    <div className="flex items-center gap-2 text-emerald-900 font-bold">
                                        <ClipboardList size={20} />
                                        Laporan Hasil Praktikum
                                    </div>
                                    <div className="flex items-center gap-3">
                                        <div className="flex items-center gap-1 text-xs text-emerald-600 bg-white/50 px-2 py-1 rounded">
                                            <Save size={14} /> Tersimpan Otomatis
                                        </div>
                                        {finalLog.length > 0 && (
                                            <button 
                                                onClick={resetAll}
                                                className="flex items-center gap-1 text-xs text-red-500 hover:text-red-700 hover:bg-red-50 px-3 py-1.5 rounded-lg transition-colors font-semibold border border-transparent hover:border-red-100"
                                            >
                                                <RefreshCw size={12} /> Reset Semua Data
                                            </button>
                                        )}
                                    </div>
                                </div>
                                <div className="overflow-x-auto">
                                    <table className="w-full text-sm text-left">
                                        <thead className="bg-slate-50/50 text-slate-500 uppercase text-xs">
                                            <tr>
                                                <th className="px-6 py-4 font-bold tracking-wider">Bahan Makanan</th>
                                                <th className="px-6 py-4 font-bold tracking-wider">Reagen</th>
                                                <th className="px-6 py-4 font-bold tracking-wider">Perubahan Warna</th>
                                                <th className="px-6 py-4 font-bold tracking-wider">Kesimpulan Siswa</th>
                                                <th className="px-6 py-4 font-bold tracking-wider">Status Analisis</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {finalLog.length === 0 ? (
                                                <tr>
                                                    <td colSpan="5" className="px-6 py-12 text-center">
                                                        <div className="flex flex-col items-center justify-center text-slate-400">
                                                            <ClipboardList size={48} className="mb-2 opacity-20" />
                                                            <p className="italic">Belum ada data praktikum yang tersimpan.</p>
                                                            <p className="text-xs mt-1">Lakukan percobaan di atas untuk mengisi tabel ini.</p>
                                                        </div>
                                                    </td>
                                                </tr>
                                            ) : (
                                                finalLog.map((log, index) => (
                                                    <tr key={index} className="hover:bg-slate-50/80 transition-colors group">
                                                        <td className="px-6 py-4 font-bold text-slate-700">{log.food}</td>
                                                        <td className="px-6 py-4">{log.reagent}</td>
                                                        <td className="px-6 py-4 text-slate-600">{log.visualResult}</td>
                                                        <td className="px-6 py-4">
                                                            <span className="bg-indigo-50 text-indigo-700 px-3 py-1 rounded-md text-xs font-bold border border-indigo-100">
                                                                {log.userConclusion}
                                                            </span>
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            {log.isCorrect ? (
                                                                <span className="flex items-center gap-1.5 text-emerald-600 font-bold text-xs bg-emerald-50 w-fit px-3 py-1 rounded-full border border-emerald-100">
                                                                    <CheckCircle size={14} /> Tepat
                                                                </span>
                                                            ) : (
                                                                <span className="flex items-center gap-1.5 text-red-500 font-bold text-xs bg-red-50 w-fit px-3 py-1 rounded-full border border-red-100">
                                                                    <XCircle size={14} /> Kurang Tepat
                                                                </span>
                                                            )}
                                                        </td>
                                                    </tr>
                                                ))
                                            )}
                                        </tbody>
                                    </table>
                                </div>

                                {completedFoods.length === FOODS.length && (
                                    <div className="bg-green-50 p-6 flex flex-col items-center text-center border-t border-green-100 animate-in slide-in-from-bottom-5">
                                        <h3 className="text-lg font-bold text-green-800 mb-2">ðŸŽ‰ Seluruh Sampel Telah Diuji!</h3>
                                        <p className="text-green-600 text-sm mb-4 max-w-md">
                                            Anda telah menyelesaikan praktikum uji makanan. Silakan kirim laporan hasil praktikum Anda ke sistem.
                                        </p>
                                        <button 
                                            onClick={handleFinishAndSend}
                                            disabled={isSending}
                                            className={`flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-full font-bold shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all text-lg ${isSending ? 'opacity-70 cursor-wait' : ''}`}
                                        >
                                            {isSending ? (
                                                <React.Fragment>
                                                    <RefreshCw className="animate-spin" size={24} /> Mengirim...
                                                </React.Fragment>
                                            ) : (
                                                <React.Fragment>
                                                    <Send size={24} /> Selesai & Kirim Laporan
                                                </React.Fragment>
                                            )}
                                        </button>
                                    </div>
                                )}

                            </div>
                        </div>
                    </main>

                    <footer className="relative z-10 text-center text-emerald-800/40 text-sm pb-8 font-medium">
                        <p>Laboratorium maya ini dikembangkan oleh Rubs</p>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<VirtualFoodLab />);
    </script>
    
    <script>
        // Sembunyikan loading jika React berhasil mount
        // Jika React gagal, loading akan tetap ada, atau error box akan muncul
        const observer = new MutationObserver((mutations) => {
            if (document.getElementById('root').innerHTML.trim().length > 0) {
                const loading = document.getElementById('loading');
                if(loading) loading.style.display = 'none';
                observer.disconnect();
            }
        });
        observer.observe(document.getElementById('root'), { childList: true, subtree: true });
    </script>
</body>
</html>
